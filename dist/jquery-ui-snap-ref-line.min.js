/**
@version 1.0.5
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e((t=t||self).jQuery)}(this,function(p){"use strict";p=p&&p.hasOwnProperty("default")?p.default:p;var c=function(t,e){void 0===e&&(e={}),e=p.extend({lineColor:"red",zIndex:10001},e),this.$container=t,this.$container.css("position","relative"),this.$canvas=p('<canvas class="ui-ref-line-canvas" />'),this.$canvas.attr({width:t.width(),height:t.height()}),this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:e.zIndex,"pointer-events":"none"}),this.$container.append(this.$canvas),this.ctx=this.$canvas[0].getContext("2d"),this.ctx.strokeStyle=e.lineColor};function l(t){return{left:parseInt(t.css("marginLeft"),10)||0,top:parseInt(t.css("marginTop"),10)||0,right:parseInt(t.css("marginRight"),10)||0,bottom:parseInt(t.css("marginBottom"),10)||0}}function u(t){return parseInt(t,10)||0}function g(t,e){return-1!==t.indexOf(e)}c.prototype.draw=function(t){var i=this;this.ctx.clearRect(0,0,this.$canvas[0].width,this.$canvas[0].height),this.ctx.beginPath(),t.forEach(function(t){var e=t[0],o=t[1];i.ctx.moveTo(e.x,e.y),i.ctx.lineTo(o.x,o.y)}),this.ctx.stroke()},c.prototype.destroy=function(){this.$canvas.remove()};var t=function(){this.queue={}};t.prototype.push=function(t,e,o){for(var i=[],n=arguments.length-3;0<n--;)i[n]=arguments[n+3];(!this.queue[t]||this.queue[t].distance>e)&&(this.queue[t]={distance:e,cb:o,args:i})},t.prototype.execute=function(){var o=this;Object.keys(this.queue).forEach(function(t){var e=o.queue[t];e.cb.apply(e,e.args)})};var d=function(t,e,o){this.elements=t,this.snapCallbacks=e,this.options=o};d.prototype.snap=function(a,r,h){var f=this,p=[],c=new t;return this.elements.forEach(function(s){var t=f.calculateDistance(r,s);Object.keys(t).forEach(function(i){var n=f.calculateTolerance(t[i],i,h);Object.keys(n).forEach(function(t){var e=n[t];if(e.ref&&p.push(f.makeRefLine(t,r,s)),e.snap&&f.snapCallbacks[i]){var o=f.snapCallbacks[i][t];o&&c.push(""+i+t,e.distance,function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];o.apply(void 0,[a].concat(t))},r,s,h)}})})}),c.execute(),p},d.prototype.makeRefLine=function(t,e,o){switch(t){case"vertical":return[{x:Math.min(o.left+o.width/2,e.left+e.width/2),y:o.top+o.height/2},{x:Math.max(o.left+o.width/2,e.left+e.width/2),y:o.top+o.height/2}];case"horizontal":return[{x:o.left+o.width/2,y:Math.min(o.top+o.height/2,e.top+e.height/2)},{x:o.left+o.width/2,y:Math.max(o.top+o.height/2,e.top+e.height/2)}];case"top":return[{x:Math.min(o.left,e.left),y:o.top},{x:Math.max(o.right,e.right),y:o.top}];case"bottom":return[{x:Math.min(o.left,e.left),y:o.bottom},{x:Math.max(o.right,e.right),y:o.bottom}];case"left":return[{x:o.left,y:Math.min(o.top,e.top)},{x:o.left,y:Math.max(o.bottom,e.bottom)}];case"right":default:return[{x:o.right,y:Math.min(o.top,e.top)},{x:o.right,y:Math.max(o.bottom,e.bottom)}]}},d.prototype.calculateTolerance=function(i,n,s){var a=this,r={};return Object.keys(i).forEach(function(t){var e=Math.abs(i[t]),o=!0;if(s)switch(t){case"horizontal":o=g(["nw","w","sw","ne","e","se"],s);break;case"vertical":o=g(["nw","n","ne","sw","s","se"],s);break;case"top":"outer"===n?o=g(["sw","s","se"],s):"inner"===n&&(o=g(["nw","n","ne"],s));break;case"bottom":"outer"===n?o=g(["nw","n","ne"],s):"inner"===n&&(o=g(["sw","s","se"],s));break;case"left":"outer"===n?o=g(["ne","e","se"],s):"inner"===n&&(o=g(["nw","w","sw"],s));break;case"right":"outer"===n?o=g(["nw","w","sw"],s):"inner"===n&&(o=g(["ne","e","se"],s))}r[t]={distance:e,snap:o&&e<=a.options.snapTolerance,ref:o&&e<=a.options.snapRefTolerance}}),r},d.prototype.calculateDistance=function(t,e){var o={};return o.center={horizontal:e.left+e.width/2-(t.left+t.width/2),vertical:e.top+e.height/2-(t.top+t.height/2)},o.outer={bottom:e.bottom-t.top,top:e.top-t.bottom,left:e.left-t.right,right:e.right-t.left},o.inner={top:e.top-t.top,bottom:e.bottom-t.bottom,left:e.left-t.left,right:e.right-t.right},o},p.ui&&p.ui.draggable&&p.ui.plugin.add("draggable","snapRef",{start:function(){var a=p(this).draggable("instance"),t=a.options;void 0===t&&(t={});var e=t,o=e.snapRef,i=e.snapRefLineColor;void 0===i&&(i="red");var n=e.snapCanvasZIndex;void 0===n&&(n=10001);var s=e.snapRefTolerance;void 0===s&&(s=30);var r=e.snapTolerance;void 0===r&&(r=20),a.refLineCanvas=new c(this.parent(),{lineColor:i,zIndex:n});var h=[];p(o.constructor!==String?o.items||":data(ui-draggable)":o).each(function(){if(this!==a.element[0]){var t=p(this),e=l(t),o=u(t.css("top"))+e.top,i=u(t.css("left"))+e.left,n=t.outerWidth(),s=t.outerHeight();h.push({item:this,width:n,height:s,top:o,left:i,bottom:o+s,right:i+n,offset:{top:e.top,left:e.left}})}}),a.snapRefManager=new d(h,{center:{vertical:function(t,e,o){t.position.top=o.top-(e.height-o.height)/2-e.offset.top},horizontal:function(t,e,o){t.position.left=o.left-(e.width-o.width)/2-e.offset.left}},inner:{top:function(t,e,o){t.position.top=o.top-e.offset.top},left:function(t,e,o){t.position.left=o.left-e.offset.left},right:function(t,e,o){t.position.left=o.right-e.width-e.offset.left},bottom:function(t,e,o){t.position.top=o.bottom-e.height-e.offset.top}},outer:{top:function(t,e,o){t.position.top=o.top-e.height-e.offset.top},left:function(t,e,o){t.position.left=o.left-e.width-e.offset.left},right:function(t,e,o){t.position.left=o.right-e.offset.left},bottom:function(t,e,o){t.position.top=o.bottom-e.offset.top}}},{snapRefTolerance:s,snapTolerance:r})},drag:function(t,e){var o=p(this).draggable("instance"),i=o.margins,n=e.position.top+i.top,s=e.position.left+i.left,a=o.helperProportions.width,r=o.helperProportions.height,h=o.snapRefManager.snap(e,{top:n,left:s,width:a,height:r,right:s+a,bottom:n+r,offset:{left:i.left,top:i.top}});o.refLineCanvas.draw(h)},stop:function(){var t=p(this).draggable("instance");t.refLineCanvas.destroy(),delete t.refLineCanvas,delete t.snapRefManager}}),p.ui.plugin.add("resizable","snapRef",{start:function(){var a=p(this).resizable("instance"),t=a.options;void 0===t&&(t={});var e=t,o=e.snapRef,i=e.snapRefLineColor;void 0===i&&(i="red");var n=e.snapCanvasZIndex;void 0===n&&(n=10001);var s=e.snapRefTolerance;void 0===s&&(s=30);var r=e.snapTolerance;void 0===r&&(r=20),a.snapRefElements=[],a.refLineCanvas=new c(this.parent(),{lineColor:i,zIndex:n}),a.margins=l(a.element);var h=[];p(o.constructor!==String?o.items||":data(ui-draggable)":o).each(function(){if(this!==a.element[0]){var t=p(this),e=l(t),o=u(t.css("top"))+e.top,i=u(t.css("left"))+e.left,n=t.outerWidth(),s=t.outerHeight();h.push({item:this,width:n,height:s,top:o,left:i,bottom:o+s,right:i+n,offset:{top:e.top,left:e.left}})}});var f={center:{horizontal:function(t,e,o,i){var n=e.left+e.width/2<o.left+o.width/2;g(["nw","w","sw"],i)&&!n?(t.size.width=2*(e.right-(o.left+o.width/2)),t.position.left=e.right-t.size.width-e.offset.left):g(["ne","e","se"],i)&&n&&(t.size.width=2*(o.left+o.width/2-e.left))},vertical:function(t,e,o,i){var n=e.top+e.height/2<o.top+o.height/2;g(["sw","s","se"],i)&&n?t.size.height=2*(o.top+o.height/2-e.top):g(["nw","n","ne"],i)&&!n&&(t.size.height=2*(e.bottom-(o.top+o.height/2)),t.position.top=e.bottom-t.size.height-e.offset.top)}},inner:{top:function(t,e,o){t.size.height=e.bottom-o.top,t.position.top=e.bottom-t.size.height-e.offset.top},bottom:function(t,e,o){t.size.height=o.bottom-e.top},left:function(t,e,o){t.size.width=e.right-o.left,t.position.left=e.right-t.size.width-e.offset.left},right:function(t,e,o){t.size.width=o.right-e.left}},outer:{top:function(t,e,o){t.size.height=o.top-e.top},bottom:function(t,e,o){t.size.height=e.bottom-o.bottom,t.position.top=e.bottom-t.size.height-e.offset.top},left:function(t,e,o){t.size.width=o.left-e.left},right:function(t,e,o){t.size.width=e.right-o.right,t.position.left=e.right-t.size.width-e.offset.left}}};a.snapRefManager=new d(h,f,{snapRefTolerance:s,snapTolerance:r})},resize:function(t,e){var o=p(this).resizable("instance"),i=o.margins,n=e.position.top+i.top,s=e.position.left+i.left,a=e.size.width,r=e.size.height,h=o.snapRefManager.snap(e,{top:n,left:s,width:a,height:r,right:s+a,bottom:n+r,offset:{left:i.left,top:i.top}},o.axis);o.refLineCanvas.draw(h)},stop:function(){var t=p(this).resizable("instance");t.refLineCanvas.destroy(),delete t.refLineCanvas}})});

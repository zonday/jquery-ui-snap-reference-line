/**
@version 1.0.7
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e((t=t||self).jQuery)}(this,function(p){"use strict";p=p&&p.hasOwnProperty("default")?p.default:p;var l=function(t,e){void 0===e&&(e={}),e=p.extend({lineColor:"red",zIndex:10001},e),this.$container=t,this.$container.css("position","relative"),this.$canvas=p('<canvas class="ui-ref-line-canvas" />'),this.$canvas.attr({width:t.width(),height:t.height()}),this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:e.zIndex,"pointer-events":"none"}),this.$container.append(this.$canvas),this.ctx=this.$canvas[0].getContext("2d"),this.ctx.strokeStyle=e.lineColor};function c(t){return{left:parseInt(t.css("marginLeft"),10)||0,top:parseInt(t.css("marginTop"),10)||0,right:parseInt(t.css("marginRight"),10)||0,bottom:parseInt(t.css("marginBottom"),10)||0}}function u(t){return parseInt(t,10)||0}function g(t,e){return-1!==t.indexOf(e)}l.prototype.draw=function(t){var o=this;this.ctx.clearRect(0,0,this.$canvas[0].width,this.$canvas[0].height),this.ctx.beginPath(),t.forEach(function(t){var e=t[0],i=t[1];o.ctx.moveTo(e.x,e.y),o.ctx.lineTo(i.x,i.y)}),this.ctx.stroke()},l.prototype.destroy=function(){this.$canvas.remove()};var t=function(){this.queue={}};t.prototype.push=function(t,e,i){for(var o=[],n=arguments.length-3;0<n--;)o[n]=arguments[n+3];(!this.queue[t]||this.queue[t].distance>e)&&(this.queue[t]={distance:e,cb:i,args:o})},t.prototype.execute=function(){var i=this;Object.keys(this.queue).forEach(function(t){var e=i.queue[t];e.cb.apply(e,e.args)})};var d=function(t,e,i){this.elements=t,this.snapCallbacks=e,this.options=i,this.refElements=[]};d.prototype.pushRefElement=function(t){-1===this.refElements.indexOf(t)&&this.refElements.push(t)},d.prototype.snap=function(a,r,f){var h=this;this.refElements=[];var p=[],l=new t;return this.elements.forEach(function(s){var t=h.calculateDistance(r,s);Object.keys(t).forEach(function(o){var n=h.calculateTolerance(t[o],o,f);Object.keys(n).forEach(function(t){var e=n[t];if(e.ref&&(p.push(h.makeRefLine(t,r,s)),h.pushRefElement(s)),e.snap&&h.snapCallbacks[o]){var i=h.snapCallbacks[o][t];i&&l.push(""+o+t,e.distance,function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];i.apply(void 0,[a].concat(t))},r,s,f)}})})}),l.execute(),p},d.prototype.makeRefLine=function(t,e,i){switch(t){case"vertical":return[{x:Math.min(i.left+i.width/2,e.left+e.width/2),y:i.top+i.height/2},{x:Math.max(i.left+i.width/2,e.left+e.width/2),y:i.top+i.height/2}];case"horizontal":return[{x:i.left+i.width/2,y:Math.min(i.top+i.height/2,e.top+e.height/2)},{x:i.left+i.width/2,y:Math.max(i.top+i.height/2,e.top+e.height/2)}];case"top":return[{x:Math.min(i.left,e.left),y:i.top},{x:Math.max(i.right,e.right),y:i.top}];case"bottom":return[{x:Math.min(i.left,e.left),y:i.bottom},{x:Math.max(i.right,e.right),y:i.bottom}];case"left":return[{x:i.left,y:Math.min(i.top,e.top)},{x:i.left,y:Math.max(i.bottom,e.bottom)}];case"right":default:return[{x:i.right,y:Math.min(i.top,e.top)},{x:i.right,y:Math.max(i.bottom,e.bottom)}]}},d.prototype.calculateTolerance=function(o,n,s){var a=this,r={};return Object.keys(o).forEach(function(t){var e=Math.abs(o[t]),i=!0;if(s)switch(t){case"horizontal":i=g(["nw","w","sw","ne","e","se"],s);break;case"vertical":i=g(["nw","n","ne","sw","s","se"],s);break;case"top":"outer"===n?i=g(["sw","s","se"],s):"inner"===n&&(i=g(["nw","n","ne"],s));break;case"bottom":"outer"===n?i=g(["nw","n","ne"],s):"inner"===n&&(i=g(["sw","s","se"],s));break;case"left":"outer"===n?i=g(["ne","e","se"],s):"inner"===n&&(i=g(["nw","w","sw"],s));break;case"right":"outer"===n?i=g(["nw","w","sw"],s):"inner"===n&&(i=g(["ne","e","se"],s))}r[t]={distance:e,snap:i&&e<=a.options.snapTolerance,ref:i&&e<=a.options.snapRefTolerance}}),r},d.prototype.calculateDistance=function(t,e){var i={};return i.center={horizontal:e.left+e.width/2-(t.left+t.width/2),vertical:e.top+e.height/2-(t.top+t.height/2)},i.outer={bottom:e.bottom-t.top,top:e.top-t.bottom,left:e.left-t.right,right:e.right-t.left},i.inner={top:e.top-t.top,bottom:e.bottom-t.bottom,left:e.left-t.left,right:e.right-t.right},i},p.ui&&p.ui.draggable&&p.ui.plugin.add("draggable","snapRef",{start:function(){var a=p(this).draggable("instance"),t=a.options;void 0===t&&(t={});var e=t,i=e.snapRef,o=e.snapRefLineColor;void 0===o&&(o="red");var n=e.snapCanvasZIndex;void 0===n&&(n=10001);var s=e.snapRefTolerance;void 0===s&&(s=30);var r=e.snapTolerance;void 0===r&&(r=20),a.refLineCanvas=new l(this.parent(),{lineColor:o,zIndex:n});var f=[];p(i.constructor!==String?i.items||":data(ui-draggable)":i).each(function(){if(this!==a.element[0]){var t=p(this),e=c(t),i=u(t.css("top"))+e.top,o=u(t.css("left"))+e.left,n=t.outerWidth(),s=t.outerHeight();f.push({item:this,width:n,height:s,top:i,left:o,bottom:i+s,right:o+n,offset:{top:e.top,left:e.left}})}}),a.snapRefManager=new d(f,{center:{vertical:function(t,e,i){t.position.top=i.top-(e.height-i.height)/2-e.offset.top},horizontal:function(t,e,i){t.position.left=i.left-(e.width-i.width)/2-e.offset.left}},inner:{top:function(t,e,i){t.position.top=i.top-e.offset.top},left:function(t,e,i){t.position.left=i.left-e.offset.left},right:function(t,e,i){t.position.left=i.right-e.width-e.offset.left},bottom:function(t,e,i){t.position.top=i.bottom-e.height-e.offset.top}},outer:{top:function(t,e,i){t.position.top=i.top-e.height-e.offset.top},left:function(t,e,i){t.position.left=i.left-e.width-e.offset.left},right:function(t,e,i){t.position.left=i.right-e.offset.left},bottom:function(t,e,i){t.position.top=i.bottom-e.offset.top}}},{snapRefTolerance:s,snapTolerance:r})},drag:function(t,e){var i=p(this).draggable("instance"),o=i.margins,n=e.position.top+o.top,s=e.position.left+o.left,a=i.helperProportions.width,r=i.helperProportions.height,f=i.snapRefManager.snap(e,{top:n,left:s,width:a,height:r,right:s+a,bottom:n+r,offset:{left:o.left,top:o.top}});i.refLineCanvas.draw(f)},stop:function(){var t=p(this).draggable("instance");t.refLineCanvas.destroy(),delete t.refLineCanvas,delete t.snapRefManager}}),p.ui&&p.ui.resizable&&p.ui.plugin.add("resizable","snapRef",{start:function(){var a=p(this).resizable("instance"),t=a.options;void 0===t&&(t={});var e=t,i=e.snapRef,o=e.snapRefLineColor;void 0===o&&(o="red");var n=e.snapCanvasZIndex;void 0===n&&(n=10001);var s=e.snapRefTolerance;void 0===s&&(s=30);var r=e.snapTolerance;void 0===r&&(r=20),a.snapRefElements=[],a.refLineCanvas=new l(this.parent(),{lineColor:o,zIndex:n}),a.margins=c(a.element);var f=[];p(i.constructor!==String?i.items||":data(ui-draggable)":i).each(function(){if(this!==a.element[0]){var t=p(this),e=c(t),i=u(t.css("top"))+e.top,o=u(t.css("left"))+e.left,n=t.outerWidth(),s=t.outerHeight();f.push({item:this,width:n,height:s,top:i,left:o,bottom:i+s,right:o+n,offset:{top:e.top,left:e.left}})}});var h={center:{horizontal:function(t,e,i,o){var n=e.left+e.width/2<i.left+i.width/2;g(["nw","w","sw"],o)&&!n?(t.size.width=2*(e.right-(i.left+i.width/2)),t.position.left=e.right-t.size.width-e.offset.left):g(["ne","e","se"],o)&&n&&(t.size.width=2*(i.left+i.width/2-e.left))},vertical:function(t,e,i,o){var n=e.top+e.height/2<i.top+i.height/2;g(["sw","s","se"],o)&&n?t.size.height=2*(i.top+i.height/2-e.top):g(["nw","n","ne"],o)&&!n&&(t.size.height=2*(e.bottom-(i.top+i.height/2)),t.position.top=e.bottom-t.size.height-e.offset.top)}},inner:{top:function(t,e,i){t.size.height=e.bottom-i.top,t.position.top=e.bottom-t.size.height-e.offset.top},bottom:function(t,e,i){t.size.height=i.bottom-e.top},left:function(t,e,i){t.size.width=e.right-i.left,t.position.left=e.right-t.size.width-e.offset.left},right:function(t,e,i){t.size.width=i.right-e.left}},outer:{top:function(t,e,i){t.size.height=i.top-e.top},bottom:function(t,e,i){t.size.height=e.bottom-i.bottom,t.position.top=e.bottom-t.size.height-e.offset.top},left:function(t,e,i){t.size.width=i.left-e.left},right:function(t,e,i){t.size.width=e.right-i.right,t.position.left=e.right-t.size.width-e.offset.left}}};a.snapRefManager=new d(f,h,{snapRefTolerance:s,snapTolerance:r})},resize:function(t,e){var i=p(this).resizable("instance"),o=i.margins,n=e.position.top+o.top,s=e.position.left+o.left,a=e.size.width,r=e.size.height,f=i.snapRefManager.snap(e,{top:n,left:s,width:a,height:r,right:s+a,bottom:n+r,offset:{left:o.left,top:o.top}},i.axis);i.refLineCanvas.draw(f)},stop:function(){var t=p(this).resizable("instance");t.refLineCanvas.destroy(),delete t.refLineCanvas}})});
